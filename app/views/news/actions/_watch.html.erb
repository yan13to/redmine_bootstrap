<% icon ||= true %>
<% text ||= false %>
<% project ||= @project %>
<% user ||= User.current  %>
<% objects ||= project.enabled_module('news') %>
<% objects = Array.wrap(objects) %>

<%#= watcher_link(project.enabled_module('news'), User.current) %>

<% if user && user.logged? && objects.any? %>
  <% watched = Watcher.any_watched?(objects, user) %>
  <% url = watch_path(object_type: objects.first.class.to_s.underscore, object_id: (objects.size == 1 ? objects.first.id : objects.map(&:id).sort)) %>
  <% method = watched ? 'delete' : 'post' %>
  <% html = [] %>
  <% html << content_tag(:i, nil, class: (watched ? 'bi bi-pin-fill' : 'bi bi-pin')) if icon %>
  <% html << content_tag(:span, (watched ? l(:button_unwatch) : l(:button_watch))) if text %>

  <%= link_to url, method: method, class: 'btn btn-primary' do %>
    <%= html.compact.join('&nbsp;').html_safe %>
  <% end %>
<% end %>